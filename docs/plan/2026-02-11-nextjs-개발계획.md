# 📋 Next.js 기반 화면 녹화 MVP 개발 계획서

**작성일자:** 2026-02-11  
**프로젝트명:** 시험용 화면 녹화 MVP  
**기술 스택:** Next.js (App Router), React, TypeScript  
**참고 문서:** [요구사항정리.md](../회의/2026-02/2026-02-11-mvp-요구사항정리.md)

---

## 📌 1. 프로젝트 구조 설계

### 1.1 폴더 구조

```
screen-record/
├── app/
│   ├── layout.tsx                 # 루트 레이아웃
│   ├── page.tsx                   # [S01] 대기 화면
│   ├── recording/
│   │   └── page.tsx               # [S03] 시험 진행 화면
│   └── complete/
│       └── page.tsx               # [S04] 시험 종료 화면
├── components/
│   ├── ui/
│   │   ├── PasswordInput.tsx      # 비밀번호 입력 컴포넌트
│   │   ├── RecordingStatus.tsx    # REC 상태 표시 바
│   │   └── ScreenShareModal.tsx   # [S02] 화면 공유 요청 모달
│   └── layout/
│       └── RecordingHeader.tsx    # 녹화 중 상단 고정 바
├── hooks/
│   ├── useScreenRecorder.ts       # 화면 녹화 로직 커스텀 훅
│   ├── usePasswordValidation.ts   # 비밀번호 검증 훅
│   └── useRecordingTimer.ts       # 녹화 시간 관리 훅
├── contexts/
│   └── RecordingContext.tsx       # 녹화 상태 전역 관리
├── utils/
│   ├── recording.ts               # 녹화 관련 유틸리티
│   └── fileDownload.ts            # 파일 다운로드 유틸리티
├── types/
│   └── recording.ts               # TypeScript 타입 정의
└── public/
    └── (로고, 아이콘 등)
```

---

## 📌 2. 기술 스택 상세

| 영역 | 기술 | 버전/설명 |
|------|------|-----------|
| **프레임워크** | Next.js | 14.x (App Router) |
| **언어** | TypeScript | 5.x |
| **스타일링** | Tailwind CSS | 3.x (선택사항) |
| **화면 캡처** | getDisplayMedia API | 브라우저 네이티브 |
| **녹화** | MediaRecorder API | 브라우저 네이티브 |
| **상태 관리** | React Context API | 내장 |
| **파일 저장** | Blob API + URL.createObjectURL | 브라우저 네이티브 |

---

## 📌 3. 단계별 개발 계획

### Phase 1: 프로젝트 셋업 및 기본 구조 (1일)

#### 작업 내용
- [ ] Next.js 프로젝트 초기화 (`npx create-next-app@latest`)
- [ ] TypeScript 설정
- [ ] 기본 폴더 구조 생성
- [ ] Tailwind CSS 설정 (선택)
- [ ] 기본 레이아웃 구성

#### 산출물
- `app/layout.tsx` - 루트 레이아웃
- 기본 스타일 설정

---

### Phase 2: 대기 화면 및 비밀번호 검증 (1일)

#### 작업 내용
- [ ] `app/page.tsx` - 대기 화면 구현
- [ ] `components/ui/PasswordInput.tsx` - 비밀번호 입력 컴포넌트
- [ ] `hooks/usePasswordValidation.ts` - 비밀번호 검증 로직
- [ ] 비밀번호 일치 시 Start 버튼 활성화
- [ ] 에러 메시지 표시

#### 핵심 코드 구조
```typescript
// hooks/usePasswordValidation.ts
const usePasswordValidation = (correctPassword: string) => {
  const [password, setPassword] = useState('');
  const [isValid, setIsValid] = useState(false);
  const [error, setError] = useState('');
  
  // 비밀번호 검증 로직
  return { password, setPassword, isValid, error };
};
```

#### 산출물
- 대기 화면 완성
- 비밀번호 검증 기능

---

### Phase 3: 화면 공유 및 녹화 기능 (2일)

#### 작업 내용
- [ ] `hooks/useScreenRecorder.ts` - 화면 녹화 커스텀 훅 구현
- [ ] `components/ui/ScreenShareModal.tsx` - 화면 공유 요청 모달
- [ ] getDisplayMedia로 화면 공유 요청
- [ ] displaySurface === "monitor" 확인 로직
- [ ] MediaRecorder 초기화 및 녹화 시작
- [ ] 녹화 중지 감지 (track.onended 이벤트)

#### 핵심 코드 구조
```typescript
// hooks/useScreenRecorder.ts
const useScreenRecorder = () => {
  const [stream, setStream] = useState<MediaStream | null>(null);
  const [recorder, setRecorder] = useState<MediaRecorder | null>(null);
  const [isRecording, setIsRecording] = useState(false);
  const [chunks, setChunks] = useState<Blob[]>([]);
  
  const startRecording = async () => {
    // 1. getDisplayMedia 호출
    // 2. displaySurface 확인
    // 3. MediaRecorder 초기화
    // 4. 녹화 시작
  };
  
  const stopRecording = () => {
    // 녹화 중지 및 Blob 생성
  };
  
  return { startRecording, stopRecording, isRecording, stream };
};
```

#### 산출물
- 화면 녹화 핵심 로직
- 화면 공유 모달 컴포넌트

---

### Phase 4: 시험 진행 화면 및 상태 표시 (1일)

#### 작업 내용
- [ ] `app/recording/page.tsx` - 시험 진행 화면 구현
- [ ] `components/layout/RecordingHeader.tsx` - 상단 고정 바
- [ ] `hooks/useRecordingTimer.ts` - 녹화 시간 표시
- [ ] REC 표시 및 실시간 시간 업데이트
- [ ] 종료 버튼 구현
- [ ] 화면 공유 중단 감지 및 자동 종료

#### 핵심 코드 구조
```typescript
// hooks/useRecordingTimer.ts
const useRecordingTimer = (isRecording: boolean) => {
  const [elapsedTime, setElapsedTime] = useState(0);
  
  useEffect(() => {
    if (!isRecording) return;
    
    const interval = setInterval(() => {
      setElapsedTime(prev => prev + 1);
    }, 1000);
    
    return () => clearInterval(interval);
  }, [isRecording]);
  
  const formatTime = (seconds: number) => {
    // HH:MM:SS 형식으로 변환
  };
  
  return { elapsedTime, formatTime };
};
```

#### 산출물
- 시험 진행 화면 완성
- 실시간 녹화 상태 표시

---

### Phase 5: 종료 및 파일 저장 (1일)

#### 작업 내용
- [ ] `app/complete/page.tsx` - 종료 화면 구현
- [ ] `utils/fileDownload.ts` - 파일 다운로드 유틸리티
- [ ] Blob을 webm 파일로 변환
- [ ] 파일명 생성 (test_학생ID_날짜.webm)
- [ ] 자동 다운로드 트리거
- [ ] 완료 메시지 표시

#### 핵심 코드 구조
```typescript
// utils/fileDownload.ts
export const downloadRecording = (blob: Blob, studentId: string) => {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `test_${studentId}_${new Date().toISOString().split('T')[0]}.webm`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};
```

#### 산출물
- 종료 화면 완성
- 파일 다운로드 기능

---

### Phase 6: 통합 및 예외 처리 (1일)

#### 작업 내용
- [ ] `contexts/RecordingContext.tsx` - 전역 상태 관리
- [ ] 페이지 간 상태 전달 (router.push with state)
- [ ] 에러 처리 및 사용자 피드백
- [ ] 브라우저 호환성 체크
- [ ] 새로고침 방지 (beforeunload 이벤트)
- [ ] 전체 흐름 통합 테스트

#### 예외 처리 시나리오
| 상황 | 처리 방식 |
|------|-----------|
| 화면 공유 거부 | 에러 메시지 표시, 재시도 버튼 |
| 브라우저 탭 선택 | "전체 화면을 선택해주세요" 알림 |
| 화면 공유 중단 | 자동 종료, 저장된 파일 다운로드 |
| 브라우저 새로고침 | 경고 메시지, 녹화 중단 |
| 파일 저장 실패 | 에러 메시지, 재시도 옵션 |

#### 산출물
- 완전한 통합 애플리케이션
- 예외 처리 완료

---

## 📌 4. 컴포넌트 설계 상세

### 4.1 컴포넌트 계층 구조

```
app/page.tsx (대기 화면)
├── PasswordInput
│   └── usePasswordValidation
└── Button (Start)

app/recording/page.tsx (시험 진행)
├── RecordingHeader
│   ├── useRecordingTimer
│   └── REC 표시
└── Button (종료)

components/ui/ScreenShareModal.tsx
└── useScreenRecorder
    ├── getDisplayMedia
    ├── displaySurface 확인
    └── MediaRecorder 초기화
```

### 4.2 상태 관리 설계

```typescript
// contexts/RecordingContext.tsx
interface RecordingState {
  isRecording: boolean;
  stream: MediaStream | null;
  recorder: MediaRecorder | null;
  recordingBlob: Blob | null;
  elapsedTime: number;
  error: string | null;
}

interface RecordingContextType {
  state: RecordingState;
  startRecording: () => Promise<void>;
  stopRecording: () => void;
  handleScreenShareEnd: () => void;
}
```

---

## 📌 5. API 사용법 및 구현 가이드

### 5.1 getDisplayMedia 사용

```typescript
const requestScreenShare = async (): Promise<MediaStream> => {
  try {
    const stream = await navigator.mediaDevices.getDisplayMedia({
      video: {
        displaySurface: 'monitor', // 전체 화면만 허용
        cursor: 'always'
      },
      audio: false
    });
    
    // displaySurface 확인
    const videoTrack = stream.getVideoTracks()[0];
    const settings = videoTrack.getSettings();
    
    if (settings.displaySurface !== 'monitor') {
      stream.getTracks().forEach(track => track.stop());
      throw new Error('전체 화면을 선택해주세요.');
    }
    
    // 공유 중단 감지
    videoTrack.onended = () => {
      handleScreenShareEnd();
    };
    
    return stream;
  } catch (error) {
    if (error.name === 'NotAllowedError') {
      throw new Error('화면 공유 권한이 거부되었습니다.');
    }
    throw error;
  }
};
```

### 5.2 MediaRecorder 사용

```typescript
const startMediaRecorder = (stream: MediaStream): MediaRecorder => {
  const options: MediaRecorderOptions = {
    mimeType: 'video/webm;codecs=vp9',
    videoBitsPerSecond: 2500000 // 2.5Mbps
  };
  
  const recorder = new MediaRecorder(stream, options);
  const chunks: Blob[] = [];
  
  recorder.ondataavailable = (event) => {
    if (event.data.size > 0) {
      chunks.push(event.data);
    }
  };
  
  recorder.onstop = () => {
    const blob = new Blob(chunks, { type: 'video/webm' });
    // 파일 다운로드 처리
    downloadRecording(blob, studentId);
  };
  
  recorder.start(1000); // 1초마다 데이터 수집
  return recorder;
};
```

---

## 📌 6. 라우팅 및 네비게이션

### 6.1 페이지 흐름

```
/ (대기 화면)
  ↓ [비밀번호 입력 + Start]
  ↓ [화면 공유 요청]
/recording (시험 진행)
  ↓ [종료 버튼 클릭]
  ↓ [파일 저장]
/complete (종료 화면)
```

### 6.2 상태 전달 방법

```typescript
// Next.js App Router에서 상태 전달
import { useRouter } from 'next/navigation';

const router = useRouter();

// 녹화 시작 시
router.push('/recording', {
  // 상태는 Context나 URL params로 전달
});

// 종료 시
router.push('/complete', {
  // Blob은 Context에 저장 후 다운로드
});
```

---

## 📌 7. 테스트 계획

### 7.1 기능 테스트 체크리스트

| 테스트 항목 | 테스트 방법 | 예상 결과 |
|------------|------------|----------|
| 비밀번호 검증 | 올바른/잘못된 비밀번호 입력 | Start 버튼 활성화/비활성화 |
| 전체 화면 선택 | getDisplayMedia에서 monitor 선택 | 녹화 시작 성공 |
| 브라우저 탭 선택 | getDisplayMedia에서 브라우저 탭 선택 | 에러 메시지, 재요청 |
| 녹화 시간 표시 | 녹화 시작 후 시간 확인 | 실시간 업데이트 (HH:MM:SS) |
| 화면 공유 중단 | 공유 중단 버튼 클릭 | 자동 종료, 파일 저장 |
| 파일 다운로드 | 종료 버튼 클릭 | webm 파일 자동 다운로드 |
| 4시간 이상 녹화 | 장시간 녹화 테스트 | 정상 작동, 파일 크기 확인 |

### 7.2 브라우저 호환성 테스트

| 브라우저 | getDisplayMedia | MediaRecorder | 테스트 결과 |
|---------|----------------|---------------|------------|
| Chrome | ✅ | ✅ | - |
| Edge | ✅ | ✅ | - |
| Firefox | ✅ | ✅ | - |
| Safari | ⚠️ (제한적) | ⚠️ | - |

---

## 📌 8. 개발 시 주의사항

### 8.1 보안 및 제약사항

- **HTTPS 필수**: getDisplayMedia는 HTTPS 환경에서만 동작
- **사용자 권한**: 화면 공유는 반드시 사용자 동의 필요
- **로컬 저장**: MVP는 로컬 저장만 지원 (서버 업로드 제외)

### 8.2 성능 고려사항

- **메모리 관리**: 장시간 녹화 시 메모리 사용량 모니터링
- **파일 크기**: 4시간 녹화 시 예상 크기 ~4.5GB (2.5Mbps 기준)
- **Blob 처리**: 대용량 파일 처리 시 메모리 누수 방지

### 8.3 사용자 경험

- **명확한 안내**: 각 단계별 사용자 안내 메시지
- **에러 복구**: 에러 발생 시 재시도 옵션 제공
- **진행 상태**: 녹화 중 명확한 상태 표시

---

## 📌 9. 향후 확장 계획 (MVP 이후)

| 기능 | 우선순위 | 예상 작업량 |
|------|---------|------------|
| 웹캠 동시 녹화 | 중 | 2일 |
| 탭 전환 감지 | 낮 | 3일 |
| 실시간 서버 업로드 | 높 | 5일 |
| 관리자 대시보드 | 중 | 7일 |
| 다중 모니터 지원 | 낮 | 2일 |

---

## 📌 10. 개발 일정 요약

| Phase | 작업 내용 | 예상 기간 | 누적 기간 |
|-------|----------|----------|----------|
| Phase 1 | 프로젝트 셋업 | 1일 | 1일 |
| Phase 2 | 대기 화면 | 1일 | 2일 |
| Phase 3 | 녹화 기능 | 2일 | 4일 |
| Phase 4 | 진행 화면 | 1일 | 5일 |
| Phase 5 | 종료 화면 | 1일 | 6일 |
| Phase 6 | 통합 및 테스트 | 1일 | **7일** |

**총 예상 기간: 7일 (1주일)**

---

## 📌 11. 다음 단계

1. ✅ 개발 계획서 작성 완료
2. ⏳ Phase 1 시작: Next.js 프로젝트 초기화
3. ⏳ 각 Phase별 진행 상황 문서화
4. ⏳ 테스트 결과 기록

---

**작성자:** AI Assistant  
**최종 수정일:** 2026-02-11
